<Macro VhostMagento2 $host $domain>

  Use VhostPhp $host $domain

  # Reuse Magento's own temp dir.
  <IfModule php7_module>
    php_admin_value upload_tmp_dir /var/www/$domain/$host/var/tmp
    php_admin_value session.save_path /var/www/$domain/$host/var/tmp
    php_admin_value sys_temp_dir /var/www/$domain/$host/var/tmp
  </IfModule>

  # Magento2 uses the non-standard "pub" document root.
  DocumentRoot "/var/www/$domain/$host/pub"

  <Directory "/var/www/$domain/$host/pub">
    Options IncludesNoExec
    Require all granted
    <IfModule rewrite_module>
      Options +SymLinksIfOwnerMatch
    </IfModule>
  </Directory>

  <Directory "/var/www/$domain/$host/pub/media">
    <IfModule php7_module>
      php_admin_flag engine off
    </IfModule>

    <IfModule rewrite_module>
      Options +SymLinksIfOwnerMatch
      RewriteEngine On

      RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-f
      RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-d
      RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-l

      RewriteRule ^(.*)$ /get.php [L]
    </IfModule>
  </Directory>

  <Directory "/var/www/$domain/$host/pub/media/customer">
    Require all denied
  </Directory>

  <Directory "/var/www/$domain/$host/pub/media/downloadable">
    Require all denied
  </Directory>

  <Directory "/var/www/$domain/$host/pub/media/import">
    Require all denied
  </Directory>

  <Directory "/var/www/$domain/$host/pub/media/theme_customization">
    <Files ~ "\.xml$">
      Require all denied
    </Files>
  </Directory>

  # Turn off rewriting for the public "errors" directory.
  <Directory "/var/www/$domain/$host/pub/errors">
    Options None
    <IfModule rewrite_module>
      RewriteEngine Off
    </IfModule>
  </Directory>

  Use Magento

  # LAY OFF ME I'M STARVING
  php_value memory_limit 768M

</Macro>
