<Macro Joomla>

  Use CmsSecureLogin

  <IfModule rewrite_module>
    RewriteEngine On

    # Block out any script trying to base64_encode data within the URL.
    RewriteCond %{QUERY_STRING} base64_encode[^(]*\([^)]*\) [OR]

    # Block out any script that includes a <script> tag in URL.
    RewriteCond %{QUERY_STRING} (<|%3C)([^s]*s)+cript.*(>|%3E) [NC,OR]

    # Block out any script trying to set a PHP GLOBALS variable via URL.
    RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]

    # Block out any script trying to modify a _REQUEST variable via URL.
    RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2})

    # Send all blocked request to homepage with 403 Forbidden error!
    # Modified to add the slash.
    RewriteRule ^(.*)$ /index.php [F,L]

    ## Begin - Joomla! core SEF Section.
    #
    # These are modified from stock to include %{DOCUMENT_ROOT},
    # and to not be completely redundant.
    #
    RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-f
    RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} !^/index.php
    RewriteCond %{REQUEST_URI} /[^.]* [NC]

    # Motherfuck! I had to fix this to include the leading slash,
    # and to stick the URI on the end of index.php. Without that,
    # it will appear to work but then fail on paths more than one
    # directory deep.
    RewriteRule (.*) /index.php$1

    # This sets the HTTP_AUTHORIZATION environment variable based on the
    # value of %{HTTP:Authorization}.
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization},L]
  </IfModule>

  #
  # Equivalent to E_ALL & ~E_STRICT in php-5.4. Can be
  # discovered via the PHP interactive shell,
  #
  #   $ php -a
  #   Interactive shell
  #
  #   php > echo (E_ALL  & ~E_STRICT) . "\n";
  #   30719
  #
  # Needed for Joomla 1.5.26 at least.
  #
  php_admin_value error_reporting 30719

</Macro>
