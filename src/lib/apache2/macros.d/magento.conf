<Macro Magento>

  # Redirect login/admin pages to HTTPS.
  <IfModule rewrite_module>
    RewriteCond %{HTTPS} off

    # If it isn't outputting clean URLs, the paths will be
    # prefixed by "index.php/".
    RewriteRule \
      ^/(index\.php/)?(admin|customer) \
      https://%{HTTP_HOST}%{REQUEST_URI} [R=301,QSA,L]
  </IfModule>

  # And fail if the redirect doesn't work.
  <LocationMatch "^/(admin|customer)">
    SSLRequireSSL
  </LocationMatch>


  # Prevent disclosure of the installed version.
  <Files RELEASE_NOTES.txt>
    Require all denied
  </Files>

  # Don't let anonymous users kick off cron jobs.
  <Files cron.php>
    Require host localhost
  </Files>

  # Clean URLs.
  <IfModule rewrite_module>
    RewriteEngine On

    # Don't rewrite any paths beneath these directories.
    RewriteCond %{REQUEST_URI} !^/(media|skin|js)/

    RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-f
    RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-d
    RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-l

    RewriteRule ^(.*)$ /index.php [L]
  </IfModule>

</Macro>
